version: genecontainer_0_1
inputs:
  result:
    default: test-result.txt
    description: Output file name
    type: string
  samplemountpath:
    default: /getresultsample
    description: hostpath mount path
    type: string
  output-prefix:
    default: '$(date "+%F %r"): '
    description: Prefix when outputting to the result file
    type: string
  wait-base:
    default: 1
    description: Base of waiting time
    type: number
  prepare-command:
    default: "echo 1 2 3 4 5"
    description: Execute commands before all commands
    type: string
  sample-pvc:
    default: sample-pvc
    description: name of pvc used
    type: string

workflow:
  jobpreparemod:
      tool: nginx:latest
      commands:
        - ${prepare-command}
  jobmod:
      tool: nginx:latest
      commands_iter:
        command: sleep `expr ${1} ${2} \* ${wait-base}`; echo ${output-prefix}${1} ${2} | tee -a ${samplemountpath}/${result};
        vars_iter:
            - [20, 21]
            - get_result(jobpreparemod, " ")
      depends:
        - target: jobpreparemod
          type: whole
  jobfinish:
      tool: nginx:latest
      commands:
        - cat ${samplemountpath}/${result} | tee -a ${samplemountpath}/${result};
      depends:
        - target: jobmod
          type: whole
volumes:
  samplepv:
    mount_path: ${samplemountpath}
    mount_from:
      pvc: ${sample-pvc}
